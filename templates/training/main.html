import { Node, Edge } from 'reactflow';

const content: Node[] = [
{% for subsection in section.subsections -%}
{% set subsection = get_section(path=subsection) -%}
{% set parent_index = loop.index -%}
{% set container_height = subsection.pages | length * 50 -%}
{
id: '{{parent_index}}',
data: { label: '{{subsection.title}}' },
position: { x: {{loop.index0 * 250 + 50}}, y: 100 },
className: 'light',
style: { backgroundColor: 'rgba(255, 0, 0, 0.2)', width: 200, height: {{ container_height + 50 }} },
draggable: false,
},
{% for page in subsection.pages -%}
{
id: '{{parent_index}}-{{loop.index}}',
data: { label: '{{page.title}}' },
position: { x: 20, y: {{loop.index0 * 50 + 50}} },
style: { width: 160 },
parentId: '{{parent_index}}',
draggable: false,
},
{% endfor -%}
{% endfor -%}
];


const dependencies: Edge[] = [
{% for subsection in section.subsections -%}
{% set subsection = get_section(path=subsection) -%}
{% set parent_index = loop.index -%}
{% for page in subsection.pages -%}
{% set page_index = loop.index -%}
{% set page_id = parent_index ~ "-" ~ page_index -%}
{% if page.extra.dependencies -%}
{% for dependency in page.extra.dependencies -%}
{% for subsection in section.subsections -%}
{% set subsection = get_section(path=subsection) -%}
{% set parent_index = loop.index -%}
{% for page in subsection.pages -%}
{% set page_index = loop.index -%}
{% if dependency == page.path -%}
{% set dependency_id = parent_index ~ "-" ~ page_index -%}
{ id: '{{page_id}}-{{dependency_id}}', target: '{{page_id}}', source: '{{dependency_id}}' },
{% endif -%}
{% endfor -%}
{% endfor -%}
{% endfor -%}
{% endif -%}
{% endfor -%}
{% endfor -%}
];

export default { content, dependencies };